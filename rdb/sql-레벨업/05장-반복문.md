# 5장 반복문

## 14강 반복문 의존증

Q: SQL에 반복문이 없는 이유 </br>
A: 반복문이 없는 것이 좋다고 생각했기 때문이다. 
> 관계 조작은 관계 전체를 모두 조작의 대상으로 삼는다. 이러한 것의 목적을 반복을 제외하는 것이다. </br>
> 최종 사용자의 생산성을 생각하면 이러한 조건을 만족해야 한다. </br>
> 그래야만 응용 프로그래머의 생산성에도 기여할 수 있을 것이다. - Relational Database: a practical foundation for productivity

절차지향적 사고에 익숙한 프로그래머가 SQL에 반복문이 없어서 저지르는 실수
1. 온라인 처리에서 화면에 명세를 출력하고자 레코드 하나씩 접근하는 SELECT구문을 반복 사용한다.
2. 배치 처리에서 대량의 데이터를 처리할 때 레코드를 하나씩 호스트 언어에서 처리하고 테이블 갱신한다.

이렇게 호스트언어에서 반복문을 사용하는 방식을 반복계라고한다. </br>
반복계로 데이터 처리하는것이 무조건적으로 옳지 않다고 할 순 없지만 많은 단점을 갖고 있다. </br>

## 15강 반복계의 공포

### 1. 반복계의 단점

1. 성능이 않좋다.
   - SQL 실행의 오버헤드 (DB연결, 반복적인 SQL 파싱, 반복적인 SQL 실행 계획 평가)
   - 병렬 분산이 힘들다. 
     - DBMS는 RAID디스크로 구성되어 있어 IO분산을 할 수 있게되어있지만 반복계의 단순한 쿼리는 DBMS의 병렬 분산을 활용할 수 없다.
   -  느린 구문을 튜닝할 수 없다.

### 2. 반복계의 장점

1. 실행 계획의 안정성 - 통계 데이터에 따라서 실행 계획의 변동성이 적다.
2. 예상 처리 시간의 정밀도 - 처리시간 = 한번 실행 시간 * 실행 횟수가 된다.
3. 트랜잭션 제어가 편리 - 중간에 오류가 나도 오류가 난 지점부터 다시 처리해서 실행하면 된다.

### 3. 반복계를 빠르게 만드는 방법

1. 반복계를 포장계로 다시 작성 --> 반복계를 다시 포장계로 바꾸기는 현실적인 일정 압박속에서 진행하기 힘들다.
2. 반복계의 단순한 쿼리를 튜닝 --> 단순한 쿼리이기에 쿼리 튜닝할 여지가 많지 않다.
3. 다중화 처리 --> 처음부터 반복계를 다중화해서 처리할 수 있게 만들었다면 가능한 방법, 단 `데이터 분할 수 있는 키`, `순서의 중요도`, `서버의 물리적 리소스`를 보고 판단해야한다.

결과적으로 반복계를 사용하면 성능 튜닝 선택지가 한정적이다.
