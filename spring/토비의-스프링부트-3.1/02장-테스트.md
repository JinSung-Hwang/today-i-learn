# 2장 테스트

스프링이 개발자에게 제공하는 가장 큰 가치 2가지는 객체지향(IoC/DI)와 테스트이다. - 토비

어플리케이션은 개발됨에 따라 변화되고 복잡해진다.
이 변환에 대응하는 첫번째 전략은 확장과 변화를 고려한 객체지향이고 두번쨰 전략은 확신과 변화에 유연함을 대처하게 하는 테스트이다.

## 2.1 UserDaoTest 다시 보기

테스트란? 코드가 예상하고 의도했던대로 정확하게 동작하는지 확인하고 확신하기 위한 작업이다.
코드의 동작을 확인하는 방법은 실제로 동작시키는 방법이나 머릿속으로 코드를 시뮬레이션 하는 방법이 있다. 
하지만 머릿속으로 코드를 시뮬레이션하는 것은 100%확신할 수 없다.

## UserDaoTest의 특징

### 웹을 통한 DAO테스트 방법의 문제점 

1. DAO를 테스트하기 위해서 Presentation Layer, Application Layer 등 포함한 모든 입출력 기능을 코드로 다 만들어야한다.
1. **모든 레이어를 다 만들고 DAO를 테스해야하는데 Error가 발생하면 어느 계층의 어느 부분에서 에러가 발생했는지 바로 알기 어렵다**.
   (스택 트레이스만 보고 바로 에러를 찾을수도 있지만 바로 못찾는 경우도 많다.)
1. UserDAO만 테스트하려고했지만 다른 코드때문이나 설정값으로 인해 UserDAO에 영향을 끼쳐 테스트가 재대로 안될수도 있다.
1. 테스트 할떄마다 매번 웹을 띄우고 테스트해야하고 웹을 테스트하는 과정중에 데이터를 잘못 입력할 수도 있다.

### 작은 단위의 테스트
웹을 통한 DAO테스트 방법의 문제점을 어떻게 고칠 수 있을까? 
단위 테스트로 가능한면 작은 부분으로 쪼개서 해당 부분을 집중해서 테스트하면 웹DAO의 테스트 방법의 문제점을 고칠 수 있다. (관심사 분리 원칙이 테스트에서도 적용)

단위 테스트란? 작은 단위의 코드에 대해 테스트를 수행하는 것을 말한다.
(단위의 크기는 정해지지 않았다. 사용자 관리 기능, 모듈 단위, 메소드 단위 등등 단위가 될 수 있다.)

단위 테스트가 DB(외부)에 의존해도 단위 테스트라고 부를 수 있는가? DB상태를 테스트가 관리하고있고 반복적으로 테스트가능하면 단위 테스트이다.
하지만 DB의 상태에 따라서 테스트 결과가 달라지면 단위 테스트라고 부를 수 없다.

단위 테스트가 필요한 이유는? 코드의 동작을 확신하기 위해서, 코드의 결함의 피드백을 빨리 받기 위해서 단위 테스트가 필요하다.
QA팀에 어플리케이션을 배포하고 코드의 버그를 피드백 받아서 다시 코드를 읽고 디버깅하는 것과 단위 테스트하며 디버깅하는것과 무엇이 디버깅이 편할까? (최신 효과)


### 자동수행 테스트 코드

자동으로 수행되는 테스트의 장점은 자주 반복할 수 있는 것이다.
번거로운 작업이 없고 테스트를 빠르게 실행할 수 있기 때문에 언제든 코드를 수정하고 나서 테스트를 해볼 수 있다.

### 지속적인 개선과 점진적인 개발을 위한 테스트

만약 처음부터 스프링을 적용하고 XML로 설정을 만들고 모든 코드를 다 만들고 난뒤에 검증을 하려고하면 아마 쏟아지는 에러 메시지에 막막해질 수 도 있다.
또 이 에러가 스프링을 잘못 사용한것인지, 설정에 오류인지, DAO 코드 자체가 문제인지 찾아내는데 많은 시간을 보낼 수 도 있다.

### 정리

2장에서는 다음과 같이 테이스의 필요성과 작성 방법을 살펴봤다.

1. 테스트는 자동화 되어야하고, 반복 수행되어야 하고, 빠르게 실행할 수 있어야 한다.
2. main() 테스트 대신 JUnit 프레임워크를 이용한 테스트 작성이 편리하다.
3. 테스트 결과는 일관성이 있어야한다. 코드의 변경 없이 환경이나 테스트 실행 순서에 따라서 결과가 달라지면 안된다. 
4. 테스트는 포괄적으로 작성해야한다. 충분한 검증을 하지 않는 테스트는 없는 것 보다 나쁠 수 있다.
5. 코드 작성과 테스트 수행의 간격이 짧을수록 효과적이다. (간격이 길면 코드 작성도 많았을거고 그러면 많은 코드중에 무엇이 에러 원인인지 찾기 어려울 수 있다.)
6. 테스트 하기 쉬운 코드가 좋은 코드다.
7. 테스트를 먼저 만들고 테스트를 성공시키는 코드를 만들어가는 테스트 주도 개발 방법도 유용하다.
8. 테스트 코드도 애플리케이션 코드와 마찬가지로 적절한 리펙토링이 필요하다.
9. @Before, @After를 사용해서 테스트 메소드들의 공통 준비 작업과 정리 작업을 처리할 수 있다.
10. 스프링 테스트 컨텍스트 프레임워크를 이용하면 테스트 성능을 향상시킬 수 있다.
11. 동일한 설정파일을 사용하는 테스트는 하나의 애플리케이션 컨텍스트를 공유한다.
12. @Autowired를 사용하면 컨텍스트의 빈을 테스트 오브젝트에 DI할 수 있다. 
13. 기술을 사용하고 방법을 익히고 이해를 돕기 위해 학습 테스트(Learning Test)를 작성하자.
14. 오류가 발견될 경우 그에 대한 버그 테스트를 만들어주면 유용하다. </br>
    (오류가 발견되면 제일 먼저 오류 발견 시나리오대로 테스트 코드를 작성해라. 그리고 반복적으로 재현하며 버그를 수정하라.)

서버 개발자라면 자신의 코드가 테스트로 검증되는 방법을 알고 있어야하고 테스트를 개발에 적극 활용할 수 있어야한다.